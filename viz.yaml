vizlab: "0.2.2.9003"
info:
  id: vizstorm
  name: Template for storm event visualizations
  date: 2017-10-26
  publish-date: 2017-11-09
  path: /vizstorm
  analytics-id: UA-78530187-1
  description: >-
    Template for storm event visualizations
  thumbnail:
    url:
    width: 250
    height: 250
    alttext:
  required-packages:
    vizlab:
      repo: github
      version: 0.2.2.9009
      name: USGS-VIZLAB/vizlab
      ref: NA
    dplyr:
      repo: CRAN
      version: 0.5.0
    maps:
      repo: CRAN
      version: 3.2.0
    mapdata: 
      repo: CRAN
      version: 2.2-6
    sf:
      repo: CRAN
      version: 0.5-4
    svglite:
      repo: github 
      version: 1.2.0.9003
      name: jread-usgs/svglite
      ref: svgnano
    sp:
      repo: CRAN
      version: 1.2.5
    geoknife:
      repo: GRAN
      version: 1.6.0
    xml2:
      repo: CRAN
      version: 1.1.1
parameter:
  -
    id: spatial_metadata
    crs: '+init=epsg:4326' # works with d3.geoAlbers
    bbox: [-87, 17, -70, 34]
  -
    id: plot_metadata
    height: 5
    width: 8
    pointsize: 12
  -
    id: animate
    start: "2017-09-10"
    stop: "2017-09-13"
    step: "hour"

fetch:
  -
    id: viewbox_limits
    location: cache/viewbox_limits.rds
    reader: rds
    fetcher: viewbox_limits
    scripts: [scripts/fetch/viewbox_limits.R , scripts/fetch/utils.R]
    depends: ["spatial_metadata", "plot_metadata"]
    comment: sets up the basic view window and projection
  -
    id: state_map_data
    location: cache/state_map_data.rds
    reader: rds
    fetcher: map_data
    fetch_args:
      database: state
    scripts: [scripts/fetch/map_data.R , scripts/fetch/utils.R]
    depends: viewbox_limits
  -
    id: precip_cell_data
    location: cache/precip_cell_data.rds
    reader: rds
    fetcher: stageiv_precip_gdp
    scripts: scripts/fetch/precip_cell_data.R
    depends: 
      sf_stencil: precip_cells
      time_info: animate
    cumulative: TRUE
  -
    id: county_map_data
    location: cache/county_map_data.rds
    reader: rds
    fetcher: map_data
    fetch_args:
      database: county
    scripts: [scripts/fetch/map_data.R , scripts/fetch/utils.R]
    depends: viewbox_limits
  -
    id: puerto_rico_map_data
    location: cache/puerto_rico_map_data.rds
    reader: rds
    fetcher: map_data
    fetch_args:
      database: world
      region: "Puerto Rico"
    scripts: [scripts/fetch/map_data.R , scripts/fetch/utils.R]
    depends: viewbox_limits
  -
    id: islands_map_data
    location: cache/islands_map_data.rds
    reader: rds
    fetcher: map_data
    fetch_args:
      database: mapdata::world2Hires
      regions: "(?!USA)"
      xlim: [275, 300]
      ylim: [16, 30]
    scripts: [scripts/fetch/map_data.R , scripts/fetch/utils.R]
    depends: viewbox_limits
process:
  -
    id: precip_cells
    location: cache/precip_cells.rds
    reader: rds
    cell_size: 0.3
    processor: cells_from_mask
    scripts: [scripts/process/cells_from_mask.R]
    depends: 
      mask_poly: "county_map_data"
  - 
    id: precip_cells_geojson
    location: cache/precip_cells.geojson
    reader: json
    processor: save_map
    scripts: [scripts/process/save_map.R]
    depends: 
      map_data: precip_cells
    mimetype: application/geo+json
  - 
    id: precip_cell_data_json
    location: cache/precip_cell_data.json
    reader: json 
    processor: precip_to_json
    scripts: [scripts/process/precip_to_json.R]
    depends: 
      precip_data: precip_cell_data
    mimetype: application/geo+json
  -
    id: precip_data_range
    location: cache/precip_data_range.json
    reader: json
    processor: calculate_precip_range
    scripts: scripts/process/calculate_precip_range.R
    depends: 
      precip_data: precip_cell_data
    mimetype: application/geo+json
  -
    id: state_map_geojson
    location: cache/state_map.geojson
    reader: json
    processor: save_map
    scripts: [scripts/process/save_map.R]
    depends: 
      map_data: state_map_data
    mimetype: application/geo+json
  -
    id: county_map_geojson
    location: cache/county_map.geojson
    reader: json
    processor: save_map
    scripts: [scripts/process/save_map.R]
    depends: 
      map_data: county_map_data
    mimetype: application/geo+json
  -
    id: puerto_rico_map_geojson
    location: cache/puerto_rico_map.geojson
    reader: json
    processor: save_map
    scripts: [scripts/process/save_map.R]
    depends: 
      map_data: puerto_rico_map_data
  -
    id: islands_map_geojson
    location: cache/islands_map.geojson
    reader: json
    processor: save_map
    scripts: [scripts/process/save_map.R]
    depends: 
      map_data: islands_map_data
visualize:

publish:
  -
    id: map_js
    location: "js/map.js"
    mimetype: application/javascript
  -
    id: map_css
    location: "layout/css/map.css"
    mimetype: text/css
  -
    id: vizstorm_page
    name: index
    template: fullpage
    publisher: page
    depends: 
      lib_d3_js: "lib-d3-js"
      lib_d3_scale_js: "lib-d3-scale-js"
      map_js: "map_js"
      map_css: "map_css"
      state_map_geojson: "state_map_geojson"
      county_map_geojson: "county_map_geojson"
      precip_cells_geojson: "precip_cells_geojson"
      precip_cell_data_json: "precip_cell_data_json"
      precip_data_range: "precip_data_range"
    context:
      resources: ["lib_d3_js", "lib_d3_scale_js", "map_css"]
      sections: ["map_js"]
      
